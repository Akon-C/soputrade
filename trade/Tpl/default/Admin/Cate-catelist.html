<include file="../Public/admintop" />
<include file="../Public/adminleft" />
<script type="text/javascript">
function sortUpdate(){
	document.catelist.action='{:U('Cate/doSortUpdate')}';
	document.catelist.submit();
}
function ishot(id,_this){
	$.post("{:U('Cate/ishot')}",'id='+id,function(data){
		$('img',_this).attr('src',data.data['imgurl']);
	},'json');
	
}
$(function(){

	$("tr[pid!='0']").hide();
	
	$("#classname>img").click (
	function() {
		var key=$(this).attr("key");
		if($(this).attr("var")=="hide"){
			$("tr[name^='"+key+"_']").show();
			$(this).attr("var","show");
			$(this).attr("src","../Public/images/menu_minus.gif");
			$("tr[name^='"+key+"_']").attr("src","../Public/images/menu_minus.gif");
		} else{
			$("tr[name^='"+key+"_']").hide();
			$(this).attr("var","hide");
			$(this).attr("src","../Public/images/menu_plus.gif");
			$("tr[name^='"+key+"_']").attr("src","../Public/images/menu_plus.gif");
		}
	});
	$("a[name^='del_']").click(
	function(){
		var answer = confirm("确认要删除吗?");
		if(answer){
			window.location = $(this).attr("href");

		}
		else{

			$(this).attr("href","javascript:void(0);");

		}

	}
	);
	$("a[name^='delproducts_']").click(
	function(){
		var answer = confirm("确认要删除所有产品吗?该操作不可恢复!");
		if(answer){
			window.location = $(this).attr("href");

		}
		else{

			$(this).attr("href","javascript:void(0);");

		}

	}
	);

});

</script>
<!-- Content (Right Column) -->
		<div id="content" class="box">

			<h1>分类管理</h1>
            <p class="msg info">提示：</p>
            	
            <p id="btn-create" class="box">
              <a href="{:U('Cate/add')}">添加新分类</a>
            </p>
            <form name="catelist" method="post" action="" >
            <table width="100%">
				<tr pid="0">
				    <th style="text-align:center" width="7%"></th>
				    <th style="text-align:center" width="15%">分类名称</th>
				    <th style="text-align:center" width="15%">排序</th>
                    <th style="text-align:center" width="7%">是否热门</th>
				    <th style="text-align:center" width="35%">描述</th>                 
                    <th style="text-align:center" >操作</th>
				</tr>
                <volist name="catetree" id="vo">
                <tr name="{$vo.key}" id="{$vo.key}" pid="{$vo.pid}">
                    <td style="text-align:left" ><input type="checkbox" name="id[]" value="{$vo.id}" /></td>
				    <td style="text-align:left" id="classname" >{:class_str_insert($vo['deep'],"&nbsp;&nbsp;&nbsp;")}<img var="hide" key="{$vo.key}" src="../Public/images/menu_plus.gif">&nbsp;<a href="{:U('Products/productslist',array('cateid'=>$vo['id']))}">{$vo.name}</a></td>
				    <td style="text-align:left" ><input type="text" value="{$vo['sort']}" name="sort[{$vo.id}]" size="5"/></td>
                    <td style="text-align:left" ><a href="#" onclick="javascript:ishot({$vo['id']},this);">{:getStatus($vo["ishot"],true)}</a></td>
                    <td style="text-align:left" >{$vo.pagetitle}</td>
                    <td style="text-align:center" ><a href="{:u('Cate/edit',array('id'=>$vo['id']))}">编辑</a>&nbsp;|&nbsp;<a name="del_{$vo.id}"  href="{:u('Cate/Delete',array('id'=>$vo['id']))}" >移除</a>&nbsp;|&nbsp;<a name="delproducts_{$vo.id}"  href="{:u('Cate/delProducts',array('id'=>$vo['id']))}" >删除所有产品</a></td>
                </tr>
                </volist>
				
			</table>
			</form>
            <p class="t-right"><input type="button" value="更新排序" onclick="sortUpdate();"/></p>
		</div> <!-- /content -->

<include file="../Public/adminfooter" />