<include file="../Public/admintop" />
<include file="../Public/adminleft" />
<script type="text/javascript">
function attr(){
	$("#listform").attr("action","{:U('Products/attredit')}");
	$("#listform").submit();
}
function delprodcuts(){
	var id=$('input:checkbox[name^=id]:checked').map(function(){
		return $(this).val();
	}).get().join(",");
	if(!id){
		alert('请选择要删除的项!');
	}else{
		$.post("{:U('Products/Delete')}","id="+id);
		$('input:checkbox[name^=id]:checked').parent().parent().remove();
	}
}
function moveprodcuts(){
	var id=$('input:checkbox[name^=id]:checked').map(function(){
		return $(this).val();
	}).get().join(",");
	if(!id){
		alert('请选择要转移的产品!');
	}else{
		$('form[name=move] input:hidden[name=id]').val(id);
		$('form[name=move]').submit();
	}
}

function setstatus(id,type,_this){
	$.post("{:U('Products/setStatus')}",{'id':id,'type':type},function(data){
		$('img',_this).attr('src',data.data['imgurl']);
	},'json');
}
function setstatus2(form){
	
	var id=$('input:checkbox[name^=id]:checked').map(function(){
		return $(this).val();
	}).get().join(",");
	if(!id){
		alert('请选择要设置的项!');
		return false;
	}else{
		$("input:hidden[name=id]",form).val(id);
		form.submit();
	}
}
$(document).ready (
function(){

	$("a[name^='del_']").click(
	function(){
		var answer = confirm("确认要删除吗?");
		if(answer){
			window.location = $(this).attr("href");

		}
		else{

			$(this).attr("href","javascript:void(0);");

		}

	}
	);
	$("#checkAll").click(
	function () {
		$("input:checkbox[name^=id]").attr("checked",$(this).attr("checked"));
	}
	);
	$(".preview").preview();

}
);

</script>
<!-- Content (Right Column) -->
		<div id="content" class="box">

			<h1>产品管理</h1>
            <p class="msg info">提示：</p>
            	
            <p id="btn-create" class="box">
              <a href="{:U('Products/add')}">添加新产品</a>
            </p>
            <p id="btn-create" class="box">
            <form action="{:U('Products/productslist')}" method="get" >
            产品名称:<input type="text" size="20" name="name" class="input-text" value="" />分类<select name="cateid" class="input-text" >
                        <option value="">请选择...</option>
                        <volist name="catetree" id="vo">
                        <option value="{$vo['id']}">{:class_str_insert($vo['deep'],"&nbsp;&nbsp;&nbsp;")}{$vo.name}</option>
                        </volist>
                        </select>
                        <input type="submit" value="搜索" />
            </form>
            </p>
            
            <p> <form action="{:U('Products/move')}" method="post" name='move' >
            移到分类:<select name="cateid" class="input-text" >
                        <option value="">请选择...</option>
                        <volist name="catetree" id="vo">
                        <option value="{$vo['id']}">{:class_str_insert($vo['deep'],"&nbsp;&nbsp;&nbsp;")}{$vo.name}</option>
                        </volist>
                        </select>
                        <input type="hidden" name="id" value="" />
                        <input type="button" value="移动" onclick="return moveprodcuts();"/>
            </form></p>
            <form action="#" method="post" id="listform">
            <table width="100%">
				<tr pid="0">
				    <th style="text-align:center" width="7%"><input type="checkbox" id="checkAll"/> ID</th>
				    <th style="text-align:center" width="25%">名称</th>
				    <th style="text-align:center" width="15%">排序</th>
                    <th style="text-align:center" width="7%">最新</th>
                    <th style="text-align:center" width="7%">热卖</th>
                    <th style="text-align:center" width="7%">推荐</th>
                    <th style="text-align:center" width="7%">特价</th>                
                    <th style="text-align:center" >操作</th>
				</tr>
                <volist name="list" id="vo">
                <tr >
                    <td style="text-align:left" ><input type="checkbox" name="id[]" value="{$vo.id}" /> <a href="{:u('Products/edit',array('id'=>$vo['id']))}">{$vo['id']}</a></td>
				    <td style="text-align:left" id="classname" ><notempty name="vo['smallimage']"><a class="preview" href="../{$vo['smallimage']}">{$vo.name}</a><else/>{$vo.name}</notempty></td>
				    <td style="text-align:left" >{$vo['sort']}</td>
                    <td style="text-align:left" ><a href="javascript:void();" onclick="javascript:setstatus({$vo['id']},'isnew',this);">{:getStatus($vo["isnew"],true)}</a></td>
                    <td style="text-align:left" ><a href="javascript:void();" onclick="javascript:setstatus({$vo['id']},'ishot',this);">{:getStatus($vo["ishot"],true)}</a></td>
                    <td style="text-align:left" ><a href="javascript:void();" onclick="javascript:setstatus({$vo['id']},'isrec',this);">{:getStatus($vo["isrec"],true)}</a></td>
                    <td style="text-align:left" ><a href="javascript:void();" onclick="javascript:setstatus({$vo['id']},'isprice',this);">{:getStatus($vo["isprice"],true)}</a></td>
                    <td style="text-align:center" ><a href="{:u('Products/attredit',array('id'=>$vo['id']))}">属性编辑</a>&nbsp;|&nbsp;<a href="{:u('Products/edit',array('id'=>$vo['id']))}">编辑</a>&nbsp;|&nbsp;<a name="del_{$vo.id}"  href="{:u('Products/Delete',array('id'=>$vo['id']))}" >移除</a></td>
                </tr>
                </volist>
				
			</table></form>
            <p class="t-left"><input type="button" value="编辑属性" onclick="attr();" /> <input type="button" value="删除产品" onclick="delprodcuts();" /><form method="post" action="{:U('Products/SetStatus2','','',false)}" >
            批量设置:
            <input type="checkbox" value="1" name="reverse"/>反向 
            <input type="button" onclick="this.form.action+='-type-isnew';return setstatus2(this.form);" value="最新"/>
            <input type="button" onclick="this.form.action+='-type-ishot';return setstatus2(this.form);" value="热卖"/>
            <input type="button" onclick="this.form.action+='-type-isrec';return setstatus2(this.form);" value="推荐"/>
            <input type="button" onclick="this.form.action+='-type-isprice';return setstatus2(this.form);" value="特价"/>
            <input type="hidden" value="" name="id"/></form></p>
            <p class="t-right">{$show}</p>
            
		</div> <!-- /content -->

<include file="../Public/adminfooter" />